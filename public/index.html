<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Universal Link & Onelink Validator</title>
    <link rel="shortcut icon" href="../img/niggie.png" type="image/x-icon">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="card">
    <h2>ğŸ”— Universal Link & Onelink Validator</h2>
    <div class="input-row">
        <input type="text" id="urlInput" placeholder="Enter URL (e.g. https://test-ts-onelink.onelink.me)">
        <button onclick="check()">Validate Now</button>
    </div>

    <div class="results" id="results" style="display:none">
        <div id="iosBox" class="os-box">
            <h3>ğŸ iOS (AASA)</h3>
            <div id="iosStatus" class="status-tag"></div>
            <div><strong>Declared Paths:</strong> <span id="iosPaths" class="value-box"></span></div>
            <pre id="iosRaw"></pre>
        </div>
        <div id="androidBox" class="os-box">
            <h3>ğŸ¤– Android (AssetLinks)</h3>
            <div id="androidStatus" class="status-tag"></div>
            <div><strong>Package Name:</strong> <span id="androidPackage" class="value-box"></span></div>
            <div><strong>Fingerprints:</strong> <span id="androidFinger" class="value-box"></span></div>
            <pre id="androidRaw"></pre>
        </div>
    </div>
</div>

<script>
async function check() {
    const url = document.getElementById('urlInput').value.trim();
    if(!url) return alert("Please enter a URL");

    try {
        const res = await fetch('/api/validate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ url })
        });
        const data = await res.json();
        document.getElementById('results').style.display = 'grid';

        // --- iOS logic ---
        const iosBox = document.getElementById('iosBox');
        const iosData = data.ios;

        // æ ¹æ“šå¾Œç«¯å›å‚³çš„ validationStatus è¨­å®šä¸åŒçš„ UI
        switch(iosData.validationStatus) {
            case 'pass':
                iosBox.className = 'os-box pass';
                document.getElementById('iosStatus').innerText = `âœ… PASS: Configuration Valid (${data.mmpType.toUpperCase()})`;
                break;
            case 'warning':
                // éœ€åœ¨ CSS ä¸­åŠ å…¥ .warning é¡åˆ¥
                iosBox.className = 'os-box warning';
                document.getElementById('iosStatus').innerText = `âš ï¸ ${iosData.message}`;
                break;
            case 'fail':
                iosBox.className = 'os-box fail';
                document.getElementById('iosStatus').innerText = `âŒ FAIL: ${iosData.message}`;
                break;
            default:
                // å…¶ä»– MMP (mmpType === "other") åªé¡¯ç¤ºåŸºæœ¬è³‡è¨Š
                iosBox.className = 'os-box';
                document.getElementById('iosStatus').innerText = `â„¹ï¸ MMP: ${data.mmpType.toUpperCase()} (Manual Check Required)`;
        }

        document.getElementById('iosPaths').innerText = iosData.declaredPaths.length ? iosData.declaredPaths.join(', ') : 'N/A';
        document.getElementById('iosRaw').innerText = JSON.stringify(iosData.details, null, 4);

        // --- Android logic ---
        const androidBox = document.getElementById('androidBox');
        const hasAndroid = data.android.status === 'Found';
        androidBox.className = 'os-box ' + (hasAndroid ? 'pass' : 'fail');
        document.getElementById('androidStatus').innerText = hasAndroid ? "âœ… PASS: AssetLinks Found" : "âŒ FAIL: File Missing";
        // åªæœ‰åœ¨æœ‰è³‡æ–™æ™‚æ‰å˜—è©¦è®€å– Package Name
        const packageName = data.android.details?.[0]?.target?.package_name;
        const fingerprints = data.android.details?.[0]?.target?.sha256_cert_fingerprints;

        document.getElementById('androidPackage').innerText = packageName || 'None Found';
        // fix SHA256 fingerprints display out of box
        document.getElementById('androidFinger').innerText = fingerprints ? fingerprints.join('\n') : 'None Found';
        document.getElementById('androidRaw').innerText = JSON.stringify(data.android.details, null, 4);

    } catch (e) { 
        console.error(e);
        alert("Error during validation.");
    }
}
</script>
</body>
</html>